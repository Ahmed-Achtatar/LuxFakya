{% extends "base.html" %}

{% block content %}
<div class="card mb-5 border-0 shadow-lg overflow-hidden" style="border-radius: 20px;" data-aos="fade-up">
    <div class="row g-0">
        <div class="col-md-6 bg-light d-flex align-items-center justify-content-center position-relative">
            <img src="{{ product.display_image_url }}" class="img-fluid" alt="{{ product.name }}" style="max-height: 500px; object-fit: contain;">
            {% if product.is_out_of_stock %}
            <div class="position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center bg-white bg-opacity-50">
                 <span class="badge bg-danger fs-1 shadow p-4">Out of Stock</span>
            </div>
            {% endif %}
        </div>
        <div class="col-md-6">
            <div class="card-body p-5 d-flex flex-column h-100 justify-content-center">
                <div class="mb-2">
                    <span class="badge bg-gold bg-opacity-10 text-gold px-3 py-2 rounded-pill text-uppercase">{{ product.category.name }}</span>
                </div>
                <h1 class="display-4 fw-bold font-serif mb-3">{{ product.name }}</h1>
                <h3 class="text-gold mb-4 display-6"><span class="force-ltr">{{ product.price }} MAD</span> <span class="fs-5 text-muted">/ {{ product.unit }}</span></h3>
                <p class="card-text lead text-muted mb-5">{{ product.description }}</p>

                {% if product.is_out_of_stock %}
                <div class="alert alert-danger mb-4" role="alert">
                    <i class="fas fa-exclamation-circle me-2"></i> This product is currently out of stock.
                </div>
                <div class="d-grid gap-3 col-lg-8">
                    <button class="btn btn-secondary btn-lg py-3 shadow-sm" disabled>
                        Out of Stock
                    </button>
                    <a href="{{ url_for('main.shop') }}" class="btn btn-outline-dark btn-lg py-3">
                        <i class="fas fa-arrow-left me-2"></i> Continue Shopping
                    </a>
                </div>
                {% else %}
                <form action="{{ url_for('main.add_to_cart', product_id=product.id) }}" method="POST">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                    <div class="d-flex align-items-center mb-4">
                        <label class="me-3 fw-bold text-muted">Quantity{% if product.unit and product.unit.lower() != 'kg' %} ({{ product.unit }}){% endif %}:</label>
                        {% if product.unit and product.unit.lower() == 'kg' %}
                        <select name="quantity" class="form-select border-secondary text-center" style="width: 140px; cursor: pointer;">
                            <option value="0.25">250g</option>
                            <option value="0.5">500g</option>
                            <option value="0.75">750g</option>
                            <option value="1.0" selected>1kg</option>
                        </select>
                        {% else %}
                        <div class="input-group" style="width: 140px;">
                            <button class="btn btn-outline-secondary" type="button" onclick="this.parentNode.querySelector('input[type=number]').stepDown()"><i class="fas fa-minus"></i></button>
                            <input type="number" name="quantity" value="1" min="0.1" step="0.01" class="form-control text-center border-secondary">
                            <button class="btn btn-outline-secondary" type="button" onclick="this.parentNode.querySelector('input[type=number]').stepUp()"><i class="fas fa-plus"></i></button>
                        </div>
                        {% endif %}
                    </div>

                    <div class="d-grid gap-3 col-lg-8">
                        <button type="submit" class="btn btn-gold btn-lg py-3 shadow-sm">
                            <i class="fas fa-shopping-bag me-2"></i> Add to Cart
                        </button>
                        <a href="{{ url_for('main.shop') }}" class="btn btn-outline-dark btn-lg py-3">
                            <i class="fas fa-arrow-left me-2"></i> Continue Shopping
                        </a>
                    </div>
                </form>
                {% endif %}
            </div>
        </div>
    </div>
</div>

{% if related_products %}
<div class="mb-5 pt-4" data-aos="fade-up" data-aos-delay="200">
    <h3 class="font-serif fw-bold mb-4">You May Also Like</h3>
    <div class="row row-cols-1 row-cols-md-3 g-4">
        {% for product in related_products %}
        <div class="col">
            <div class="card h-100 border-0 shadow-sm h-100">
                <div class="position-relative overflow-hidden">
                    <img src="{{ product.display_image_url }}" class="card-img-top" alt="{{ product.name }}" style="height: 300px; object-fit: cover;">
                    <div class="position-absolute bottom-0 start-0 w-100 p-3 bg-gradient-dark text-white opacity-0 transition-all">
                        <a href="{{ url_for('main.add_to_cart', product_id=product.id) }}" class="btn btn-light btn-sm w-100 stretched-link">Quick Add</a>
                    </div>
                </div>
                <div class="card-body text-center p-4">
                    <h5 class="card-title font-serif fw-bold mb-2">{{ product.name }}</h5>
                    <p class="card-text text-gold fw-bold fs-5 force-ltr">{{ product.price }} MAD / {{ product.unit }}</p>
                    <a href="{{ url_for('main.product_detail', product_id=product.id) }}" class="btn btn-outline-dark btn-sm mt-2 rounded-pill px-4">View Details</a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}
{% endblock %}
